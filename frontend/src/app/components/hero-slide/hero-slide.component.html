<div
  *ngIf="slides.length; else heroSkeleton"
  class="relative w-full bg-white dark:bg-background-dark overflow-hidden lg:py-14"
  aria-live="polite"
>
  <div
    class="site-container flex flex-col md:flex-row min-h-[600px] h-auto md:h-[700px]"
  >
    <!-- LEFT (Text) -->
    <div
      *ngIf="activeSlide as active"
      class="w-full md:w-1/2 flex flex-col justify-center relative z-10 bg-white dark:bg-background-dark transition-all duration-700 ease-out motion-reduce:transition-none motion-reduce:transform-none motion-reduce:opacity-100"
      [ngClass]="
        animateIn ? 'opacity-100 translate-x-0' : 'opacity-0 ' + textOffsetClass
      "
    >
      <!-- Staggered elements -->
      <div
        class="flex items-center gap-2 mb-6 transition-all duration-700 ease-out delay-[60ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + textOffsetClass
        "
      >
        <span class="w-8 h-[2px] bg-primary"></span>
        <span
          class="text-primary font-bold uppercase tracking-widest text-sm"
          >{{ active.topic }}</span
        >
      </div>

      <h1
        class="text-4xl md:text-6xl font-black leading-tight text-[#111418] dark:text-white mb-6 transition-all duration-700 ease-out delay-[120ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + textOffsetClass
        "
      >
        {{ active.title }} <br />
        <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-blue-400"
        >
          {{ active.topic }}
        </span>
      </h1>

      <p
        class="text-[#637588] dark:text-gray-400 text-lg mb-8 leading-relaxed max-w-md transition-all duration-700 ease-out delay-[180ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + textOffsetClass
        "
      >
        {{ active.des }}
      </p>

      <div
        class="flex flex-nowrap md:flex-wrap gap-3 sm:gap-4 mb-12 transition-all duration-700 ease-out delay-[240ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + textOffsetClass
        "
      >
        <a
          class="flex-1 min-w-0 bg-primary hover:bg-primary/90 text-white px-4 sm:px-8 py-4 rounded-lg text-sm font-bold shadow-lg shadow-primary/30 transition-all flex items-center justify-center gap-2 group whitespace-nowrap"
          [routerLink]="['/projectdetails', active.id]"
          [attr.aria-label]="'Explore ' + active.title"
        >
          Explore Project
          <span
            class="material-symbols-outlined group-hover:translate-x-1 transition-transform"
          >
            arrow_forward
          </span>
        </a>

        <a
          class="flex-1 min-w-0 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 text-[#111418] dark:text-white px-4 sm:px-8 py-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center whitespace-nowrap"
          [routerLink]="['/project']"
          aria-label="Download project brochure"
        >
          Download Brochure
        </a>
      </div>

      <div
        class="grid grid-cols-3 gap-4 border-t border-gray-100 dark:border-gray-800 pt-8 mt-auto md:mt-0 transition-all duration-700 ease-out delay-[300ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + textOffsetClass
        "
      >
        <div class="text-center md:text-left">
          <p
            class="text-xl sm:text-2xl md:text-3xl font-bold text-[#111418] dark:text-white"
          >
            {{ active.author }}
          </p>
          <p
            class="text-xs sm:text-sm text-[#637588] dark:text-gray-500 uppercase tracking-wide"
          >
            Stories
          </p>
        </div>

        <div class="text-center md:text-left">
          <p
            class="text-xl sm:text-2xl md:text-3xl font-bold text-[#111418] dark:text-white"
          >
            {{ active.thumbnailTitle }}
          </p>
          <p
            class="text-xs sm:text-sm text-[#637588] dark:text-gray-500 uppercase tracking-wide"
          >
            Units
          </p>
        </div>

        <div class="text-center md:text-left">
          <p
            class="text-xl sm:text-2xl md:text-3xl font-bold text-[#111418] dark:text-white"
          >
            {{ active.thumbnailDescription }}
          </p>
          <p
            class="text-xs sm:text-sm text-[#637588] dark:text-gray-500 uppercase tracking-wide"
          >
            Completion
          </p>
        </div>
      </div>

      <div class="absolute bottom-8 left-8 md:left-16 flex gap-4">
        <button
          type="button"
          class="w-12 h-12 rounded-full border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-primary hover:text-white hover:border-primary transition-all text-[#111418] dark:text-white"
          (click)="prev()"
          aria-label="Previous highlight"
        >
          <span class="material-symbols-outlined">chevron_left</span>
        </button>
        <button
          type="button"
          class="w-12 h-12 rounded-full border border-gray-200 dark:border-gray-700 flex items-center justify-center hover:bg-primary hover:text-white hover:border-primary transition-all text-[#111418] dark:text-white"
          (click)="next()"
          aria-label="Next highlight"
        >
          <span class="material-symbols-outlined">chevron_right</span>
        </button>
      </div>
    </div>

    <!-- RIGHT (Image) -->
    <div
      class="w-full md:w-1/2 relative h-[70vh] sm:h-[75vh] md:h-full bg-gray-100 dark:bg-gray-800 overflow-hidden transition-all duration-700 ease-out motion-reduce:transition-none motion-reduce:transform-none motion-reduce:opacity-100"
      [ngClass]="
        animateIn
          ? 'opacity-100 translate-x-0'
          : 'opacity-0 ' + imageOffsetClass
      "
    >
      <!-- Crossfade image (no more instant swap) -->
      <div class="absolute inset-0">
        <ng-container
          *ngFor="let s of slides; let i = index; trackBy: trackBySlide"
        >
          <div
            class="absolute inset-0 transition-opacity duration-700 ease-out motion-reduce:transition-none"
            [class.opacity-100]="i === currentIndex"
            [class.opacity-0]="i !== currentIndex"
          >
            <div
              class="absolute inset-0 bg-cover bg-center bg-no-repeat will-change-transform transition-transform duration-700 ease-out"
              [style.backgroundImage]="'url(' + s.image + ')'"
              [ngClass]="
                i === currentIndex && animateIn ? 'scale-100' : 'scale-[1.03]'
              "
            ></div>
          </div>
        </ng-container>

        <div
          class="absolute inset-0 bg-gradient-to-l from-transparent via-transparent to-white/10 dark:to-background-dark/20 pointer-events-none"
        ></div>
      </div>

      <div
        class="absolute bottom-8 right-8 bg-white/90 dark:bg-background-dark/90 backdrop-blur-md p-4 rounded-xl shadow-xl max-w-xs hidden md:block transition-all duration-700 ease-out delay-[180ms] motion-reduce:transition-none motion-reduce:transform-none"
        [ngClass]="
          animateIn
            ? 'opacity-100 translate-x-0'
            : 'opacity-0 ' + imageOffsetClass
        "
      >
        <div class="flex items-start gap-4">
          <div
            class="w-16 h-16 rounded-lg bg-cover bg-center"
            [style.backgroundImage]="'url(' + activeSlide?.image + ')'"
          ></div>
          <div>
            <h4 class="font-bold text-[#111418] dark:text-white text-sm">
              {{ activeSlide?.title }}
            </h4>
            <p class="text-xs text-[#637588] dark:text-gray-400 mt-1">
              {{ activeSlide?.author }}
            </p>
            <a
              class="text-primary text-xs font-bold mt-2 inline-block hover:underline"
              [routerLink]="['/projectdetails', activeSlide?.id]"
            >
              View Details
            </a>
          </div>
        </div>
      </div>

      <div
        class="absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-2 md:hidden"
      >
        <button
          *ngFor="let slide of slides; index as i; trackBy: trackBySlide"
          type="button"
          class="w-2 h-2 rounded-full transition-opacity duration-300 motion-reduce:transition-none"
          [ngClass]="{
            'bg-white opacity-100': i === currentIndex,
            'bg-white/50 opacity-80': i !== currentIndex
          }"
          (click)="goToSlide(i)"
          [attr.aria-label]="'Go to slide ' + (i + 1)"
        ></button>
      </div>
    </div>
  </div>
</div>

<ng-template #heroSkeleton>
  <section
    class="relative isolate flex h-[480px] items-center justify-center overflow-hidden bg-slate-950 lg:h-screen"
    aria-busy="true"
  >
    <div
      class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.18),_transparent_55%)]"
    ></div>
    <div
      class="h-32 w-32 animate-pulse rounded-full border border-white/10 bg-white/5"
    ></div>
  </section>
</ng-template>
